<!doctype html>
<html>
	<head>
		<title>
			Games
		</title>
		<base target="_blank">
		<script src="https://epicenterprograms.github.io/standards/behavior/general.js"></script>
		<script src="https://epicenterprograms.github.io/standards/behavior/storage.js"></script>
		<script src="https://epicenterprograms.github.io/standards/behavior/game.js"></script>
		<script src="behavior.js"></script>
		<script>
			S.listen("checkCode", "click", function () {
				document.body.style.cursor = "wait";
				S.getId("checkCode").disabled = true;
				let code = encodeURIComponent(S.getId("saveCode").value.trim());
				M.server.recall("~websites/games/codes/" + code + "/players present").then(function (value) {
					document.body.style.cursor = "auto";
					if (S.getType(value) != "Number" || value < 1) {
						M.session.store("save code", code);
						//// store code on server
						S.getId("checkCode").disabled = false;
						S.makeDialog("Save code created.");
					} else {
						let plurality;
						if (value == 1) {
							plurality = " person is ";
						} else {
							plurality = " people are ";
						}
						S.makeDialog(value + plurality + "already using this code. Continue?",
							["Yes", function () {
								M.session.store("save code", code);
								//// store code on server
							}],
							["No", function () {
								S.getId("saveCode").value = "";
								M.session.forget("save code");  // not necessary
							}]
						).then(function () {
							S.getId("checkCode").disabled = false;
						});
					}
				});
			});
		</script>
		<link rel="stylesheet" href="https://epicenterprograms.github.io/standards/formatting/foundation.css">
		<link rel="stylesheet" href="https://epicenterprograms.github.io/standards/formatting/game.css">
	</head>
	<body>
		<nav class="hidden-left-nav">
			<iframe src="navigation.html"></iframe>
		</nav>
		<h1 class="main-title">
			Home
		</h1>
		<main>
			<section>
				This allows you to play games. Use the same save code as a friend to play with them online.
			</section>
			<h4>
				Set your save code
			</h4>
			<input type="text" id="saveCode" placeholder="Code">
			<button id="checkCode">
				Check and set
			</button>
		</main>
	</body>
</html>
